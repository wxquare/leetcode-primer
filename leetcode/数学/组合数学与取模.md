# **ç»„åˆæ•°å­¦å–æ¨¡è®¡ç®—**

åœ¨ **ç»„åˆæ•°å­¦** ä¸­ï¼Œè®¡ç®—ç»„åˆæ•° \( C(n, k) \) æ—¶ï¼Œå¸¸å¸¸éœ€è¦å¯¹ä¸€ä¸ª **å¤§è´¨æ•° \( p \)** å–æ¨¡ï¼Œä»¥é˜²æ­¢æº¢å‡ºï¼Œç‰¹åˆ«æ˜¯åœ¨**ç«žèµ›ç¼–ç¨‹**å’Œ**å¯†ç å­¦**ä¸­å¸¸è§ã€‚

å…¬å¼ï¼š
$$
C(n, k) = \binom{n}{k} = \frac{n!}{k!(n-k)!} \mod p
$$

ç”±äºŽ**ç›´æŽ¥è®¡ç®—é˜¶ä¹˜ä¼šå¯¼è‡´æº¢å‡º**ï¼Œéœ€è¦ä½¿ç”¨**æ¨¡è¿ç®—æŠ€å·§**ï¼Œå¦‚**è´¹é©¬å°å®šç†**æˆ–**Lucas å®šç†**ã€‚

---

## **1. é¢„å¤„ç†é˜¶ä¹˜ + é€†å…ƒï¼ˆé€‚ç”¨äºŽ \( p \) ä¸ºè´¨æ•°ï¼‰**
å¦‚æžœ \( p \) æ˜¯ä¸€ä¸ª **è´¨æ•°**ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **è´¹é©¬å°å®šç†**ï¼š

$$
a^{p-1} \equiv 1 \pmod{p} \Rightarrow a^{p-2} \equiv a^{-1} \pmod{p}
$$

å³ï¼š
$$
\frac{1}{a} \equiv a^{p-2} \pmod{p}
$$
è¿™æ ·å¯ä»¥é«˜æ•ˆæ±‚å–é€†å…ƒã€‚

### **C++ å®žçŽ°**
```cpp
const int MOD = 1e9+7;
const int MAXN = 1000001;
long long fact[MAXN], invFact[MAXN];

// å¿«é€Ÿå¹‚æ±‚é€†å…ƒ
long long modPow(long long base, long long exp, long long mod) {
    long long res = 1;
    while (exp > 0) {
        if (exp % 2 == 1) res = (res * base) % mod;
        base = (base * base) % mod;
        exp /= 2;
    }
    return res;
}

// é¢„è®¡ç®—é˜¶ä¹˜å’Œé€†å…ƒ
void precompute() {
    fact[0] = invFact[0] = 1;
    for (int i = 1; i < MAXN; i++) {
        fact[i] = fact[i-1] * i % MOD;
    }
    invFact[MAXN-1] = modPow(fact[MAXN-1], MOD-2, MOD);
    for (int i = MAXN - 2; i > 0; i--) {
        invFact[i] = invFact[i+1] * (i+1) % MOD;
    }
}

// è®¡ç®—ç»„åˆæ•° C(n, k) % MOD
long long comb(int n, int k) {
    if (k > n || k < 0) return 0;
    return fact[n] * invFact[k] % MOD * invFact[n-k] % MOD;
}
```
ðŸ“Œ **å¤æ‚åº¦**ï¼š
- **é¢„å¤„ç†** é˜¶ä¹˜ + é€†å…ƒï¼š\( O(n) \)
- **æŸ¥è¯¢ç»„åˆæ•°**ï¼š\( O(1) \)

---

## **2. Lucas å®šç†ï¼ˆé€‚ç”¨äºŽ \( p \) ä¸ºè´¨æ•°ï¼Œä¸” \( n, k \) å¾ˆå¤§ï¼‰**
å¦‚æžœ \( n \) å’Œ \( k \) å¾ˆå¤§ï¼Œä½† **\( p \) ä¾ç„¶æ˜¯è´¨æ•°**ï¼Œå¯ä»¥ä½¿ç”¨ **Lucas å®šç†**ï¼š
\[
C(n, k) \mod p = C(n / p, k / p) \times C(n \mod p, k \mod p) \mod p
\]
é€’å½’è®¡ç®—å³å¯ã€‚

### **C++ å®žçŽ°**
```cpp
long long lucas(long long n, long long k, long long p) {
    if (k == 0) return 1;
    return comb(n % p, k % p) * lucas(n / p, k / p, p) % p;
}
```
ðŸ“Œ **é€‚ç”¨äºŽè¶…å¤§ \( n, k \)**ï¼Œä½† **\( p \)** å¿…é¡»æ˜¯ **å°è´¨æ•°**ï¼ˆå¦‚ 1e6 ä»¥å†…ï¼‰ã€‚

---

## **3. ä¹˜æ³•é€†å…ƒ (æ‰©å±•æ¬§å‡ é‡Œå¾—)ï¼ˆé€‚ç”¨äºŽ \( p \) ä¸æ˜¯è´¨æ•°ï¼‰**
å¦‚æžœ \( p \) ä¸æ˜¯è´¨æ•°ï¼Œåˆ™ **è´¹é©¬å°å®šç†æ— æ³•ä½¿ç”¨**ï¼Œå¿…é¡»ç”¨ **æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•** æ±‚é€†å…ƒï¼š
\[
ax + by = \gcd(a, b)
\]
å½“ \( \gcd(a, p) = 1 \) æ—¶ï¼š
\[
ax \equiv 1 \pmod{p}
\]
åˆ™ \( x \) å³ä¸º \( a \) çš„**ä¹˜æ³•é€†å…ƒ**ã€‚

### **C++ å®žçŽ°**
```cpp
long long modInverse(long long a, long long p) {
    long long x, y;
    long long g = extendedGCD(a, p, x, y);
    if (g != 1) return -1;  // ä¸å­˜åœ¨é€†å…ƒ
    return (x % p + p) % p;
}

// æ‰©å±•æ¬§å‡ é‡Œå¾—ç®—æ³•
long long extendedGCD(long long a, long long b, long long &x, long long &y) {
    if (b == 0) {
        x = 1, y = 0;
        return a;
    }
    long long x1, y1;
    long long g = extendedGCD(b, a % b, x1, y1);
    x = y1;
    y = x1 - (a / b) * y1;
    return g;
}
```
ðŸ“Œ **é€‚ç”¨äºŽ**ï¼š\( p \) **ä¸æ˜¯è´¨æ•°**çš„æƒ…å†µã€‚

---

## **æ€»ç»“**
| æ–¹æ³• | é€‚ç”¨æƒ…å†µ | å¤æ‚åº¦ | é¢å¤–ä¿¡æ¯ |
|------|----------|---------|-------------|
| **è´¹é©¬å°å®šç†** | \( p \) æ˜¯è´¨æ•° | é¢„å¤„ç† \( O(n) \)ï¼ŒæŸ¥è¯¢ \( O(1) \) | é€‚ç”¨äºŽå¤§èŒƒå›´æ•°æ® |
| **Lucas å®šç†** | \( p \) æ˜¯è´¨æ•°ï¼Œ\( n, k \) å¾ˆå¤§ | é€’å½’ \( O(\log n) \) | é€‚ç”¨äºŽè¶…å¤§æ•° |
| **æ‰©å±•æ¬§å‡ é‡Œå¾—** | \( p \) ä¸æ˜¯è´¨æ•° | \( O(\log p) \) | ç”¨äºŽä¸€èˆ¬å–æ¨¡é—®é¢˜ |

å¦‚æžœ \( p \) æ˜¯è´¨æ•°ï¼Œ**è´¹é©¬å°å®šç† + é¢„å¤„ç†é˜¶ä¹˜** æ˜¯æœ€ä½³æ–¹æ³•ï¼ ðŸš€

